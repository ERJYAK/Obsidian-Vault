# Исполняющая среда 

**.NET Runtime** состоит из **Библиотеки Базовых Классов ([[#BCL]])** и **[[#CLR]]**. Исполняющая среда так же, дополнительно может содержать `API-интерфейсы` и фреймворки (ASP.NET Core, WPF и т.п.). 

**Исполняющая среда** (также называемая `инфраструктурой` или **Runtime environment**) - это развертываемая единица, которую можно загрузить и установить. Исполняющая среда состоит из среды **[[#CLR]]** (со своей библиотекой **[[#BCL]]**) и необязательного прикладного слоя (ASP.NET Core, WPF и т.п.).  
При написании приложения разарботчки нацеливается на конкретную **исполняющую среду**, т.е. ваше приложение использует и зависит от функциональности, которую обеспечивает исполняющая среда. Выбор исполняющей среды также определяет, какие платформы будет поддерживать приложение.

Если резюмировать, то при установке **.NET** (или **.NET Framework**) мы получаем и [[#CLR]], и базовые библиотеки [[#BCL]], а для ASP.NET Core и других фреймворков обычно есть добавочные компоненты, а сторонние библиотеки и высокоуровневые фреймворки могут подключаться по мере необходимости. **Важно понимать**, что **исполняющая среда** подходит для машин пользователей или серверов, где нужно **только** запускать уже скомпилированные .NET-приложения. Компилятор (из исходного кода в **[IL](#^d30795)**) и инструменты сборки при этом не устанавливаются.


## CLR

**Common Language Runtime** - общеязыковая исполняющая среда (просто потому что используется также для F#, VB и др.). Предоставляет важные службы времени выполнения, такие как автоматическое управление памятью и обработка исключений. 
**CLR** - ядро **исполняющей среды** .NET. 

В основном программист не управляет выделением и освобождением **памяти**, за это отвечает **CLR**, а именно **GC**. 
Язык С# не исключает указатели. Для *горячих* точек, критичных к производительности,  указатели и явное выделение памяти разрешены в блоках, которые явно помечены как `unsafe` (т.е. небезопасные).

### Компиляция 

С# называют управляемым языком, потому что его компилятор компилирует исходный код в `управляемый код`, который представлен на `промежуточном` языке (**Intermed** **Language** - **IL**). ^d30795

При запуске приложения **CLR** загружает **IL-код**, а затем **JIT**-компиолятор (**Just-In-Time**) преобразует **IL-код** в собственный код машины, такой как Х64 или Х86, обычно прямо перед выполнением.  

Так же сущесвует **NGen** (старый подход на Windows/.NET Framework) или **R2R** (ReadyToRun) для **AOT** (Ahead-of-Time Compilation), позволяющий часть **IL** закомпилировать заранее для улучшения показателей времени начального запуска в случае крупных сборок или устройств с ограниченными ресурсами. 
Современный подход (начиная с .NET 7) **Native AOT** ― позволяет собрать приложение в нативный исполняемый файл без необходимости **JIT** на машине пользователя.

Контейнер для управляемого кода называется `сборкой`(**assembly**) - файлы `.dll` или `.exe`. Сборка содержит не только код **IL**, но также метаданные (типы, методы, референсы на другие сборки), манифест (версии, неймспейсы, ресурсы), а также, возможно, встроенные ресурсы (resx). Наличие метаданных дает возможность сборкам ссылаться на типы в других сборках, не нуждаясь в дополнительных файлах.

## BCL

Среда **CLR** всегда поставляется с комплектом сборок, который называется библиотекой базовых классов (**Base Class Library - BCL**). Важно понимать, то **BCL** именно поставляется вместе с **CLR**, а не является ее частью.
**BCL** предлагает программистам основную функциональность, такую как коллекции, ввод-вывод, обработка текста, поддержка XМL/JSON, работа с сетью, шифрование, возможность взаимодействия и параллельное программирование. В библиотеке **BCL** также реализованы типы, которые требуются самому языку С# (для средств, подобных перечислению и асинхронности) и позволяют явно получать доступ к средствам CLR вроде рефлексии(доступ к метаданым) и управления памятью.

# SDK

**SDK (Software Development Kit)** — это набор инструментов, библиотек, документации и примеров кода, которые упрощают и ускоряют разработку приложений или библиотек для конкретной платформы (ОС, среды выполнения, облачного сервиса и т.д.).

Например, существуют SDK для Android, iOS, AWS, Azure и т. д. Они содержат всё необходимое, чтобы разработчик мог легко писать код, пользоваться нужными API, собирать и тестировать приложение.

## .NET SDK 

Это официальный набор инструментов от Microsoft для разработки на платформах .NET (включая C#, F#, Visual Basic).

 **Что входит в .NET SDK:**
1. **.NET Runtime (базовый набор):**
    
    1. [[#CLR]] 
        
    2.  [[#BCL]]
        
2. **Компиляторы Roslyn и другие инструменты**
    
    - C# compiler, F# compiler, VB.NET compiler.
        
    - Roslyn — это “современный” компилятор Microsoft, предоставляющий также API для анализа кода (Code Analysis) и рефакторинга.
        
3. **.NET CLI (Command Line Interface)**
    
    - Основная утилита называется `dotnet`.
        
    - Через неё можно выполнять команды:
        
        - `dotnet new` — создание проекта из шаблона (консольное приложение, библиотека, ASP.NET Core и т. п.).
            
        - `dotnet build` — сборка проекта.
            
        - `dotnet run` — запуск приложения из исходных кодов (автоматически соберёт и запустит).
            
        - `dotnet test` — запуск тестов (поддерживается xUnit, MSTest, NUnit и др.).
            
        - `dotnet publish` — упаковка приложения для деплоя (можно собрать self-contained или framework-dependent).
            
4. **MSBuild и связанные с ним компоненты**
    
    - MSBuild — движок сборки .NET-проектов, который читает файлы `.csproj`/`.vbproj` и orchestrates процесс: компиляция, копирование ресурсов, упаковка итоговых бинарных файлов и т. д.
        
5. **Шаблоны проектов и другие “вспомогательные” вещи**
    
    - Проекты ASP.NET Core, WPF, библиотека классов, worker-сервис и т.д. — всё это предоставляется в виде шаблонов, включённых в SDK.